<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Challenge Bot - Run Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 30px;
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #00ff88;
        }
        .stat-label { color: #aaa; margin-top: 8px; }
        .chart-container {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
        }
        .runs-list { margin-top: 30px; }
        .run-card {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .run-header {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        .run-header:hover { background: rgba(255,255,255,0.05); }
        .run-meta { display: flex; gap: 24px; align-items: center; }
        .run-version {
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            color: #000;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .run-time { font-size: 1.5rem; font-weight: bold; }
        .run-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        .run-status.success { background: #00ff8833; color: #00ff88; }
        .run-status.failed { background: #ff444433; color: #ff4444; }
        .run-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: rgba(0,0,0,0.2);
        }
        .run-details.open { max-height: 800px; }
        .run-details-content { padding: 20px; }
        .steps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
        }
        .step-item {
            background: rgba(255,255,255,0.05);
            padding: 8px 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.85rem;
            display: flex;
            justify-content: space-between;
        }
        .step-code { color: #00d4ff; }
        .step-time { color: #888; }
        .arrow { transition: transform 0.3s; }
        .arrow.open { transform: rotate(180deg); }
        .no-cost {
            background: rgba(255,255,255,0.05);
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            color: #888;
            margin-top: 20px;
        }
        .add-run-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            color: #000;
            border: none;
            padding: 16px 24px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,255,136,0.3);
        }
        .version-filter {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .version-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .version-btn.active {
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            color: #000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Browser Challenge Bot</h1>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalRuns">0</div>
                <div class="stat-label">Total Runs</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="successRate">0%</div>
                <div class="stat-label">Success Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgTime">0s</div>
                <div class="stat-label">Avg Time</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="bestTime">0s</div>
                <div class="stat-label">Best Time</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">$0.00</div>
                <div class="stat-label">Total Cost (No AI)</div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="timeChart" height="100"></canvas>
        </div>

        <div class="version-filter">
            <button class="version-btn active" onclick="filterRuns('all')">All</button>
            <button class="version-btn" onclick="filterRuns('1')">v1</button>
            <button class="version-btn" onclick="filterRuns('2')">v2</button>
            <button class="version-btn" onclick="filterRuns('3')">v3</button>
        </div>

        <div class="runs-list" id="runsList"></div>

        <div class="no-cost">
            <strong>No AI Token Costs</strong><br>
            This bot uses pure browser automation with session decryption.<br>
            No Claude API calls = $0.00 cost per run.
        </div>
    </div>

    <div style="position:fixed;bottom:30px;right:30px;">
        <button class="add-run-btn" onclick="loadRunsFromFile()">Refresh</button>
    </div>

    <script>
        let runs = [];
        let chart = null;

        // Auto-load runs.json on page load
        async function loadRunsFromFile() {
            try {
                const response = await fetch('runs.json?' + Date.now());
                runs = await response.json();
                updateStats();
                updateChart();
                renderRuns();
            } catch (e) {
                console.log('No runs.json found, starting fresh');
            }
        }
        loadRunsFromFile();

        function updateStats() {
            const successful = runs.filter(r => r.result === 'SUCCESS');
            document.getElementById('totalRuns').textContent = runs.length;
            document.getElementById('successRate').textContent =
                runs.length ? Math.round((successful.length / runs.length) * 100) + '%' : '0%';

            if (successful.length) {
                const times = successful.map(r => r.total_duration_seconds);
                document.getElementById('avgTime').textContent =
                    (times.reduce((a,b) => a+b, 0) / times.length).toFixed(2) + 's';
                document.getElementById('bestTime').textContent =
                    Math.min(...times).toFixed(2) + 's';
            }
        }

        function updateChart() {
            const ctx = document.getElementById('timeChart').getContext('2d');
            const successful = runs.filter(r => r.result === 'SUCCESS').slice(-20);

            if (chart) chart.destroy();

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: successful.map(r => {
                        // Extract time portion from timestamp like "2026-02-02 22:10:47"
                        const parts = (r.timestamp || '').split(' ');
                        return parts[1] || `Run`;
                    }),
                    datasets: [{
                        label: 'Time (seconds)',
                        data: successful.map(r => r.total_duration_seconds),
                        borderColor: '#00ff88',
                        backgroundColor: 'rgba(0, 255, 136, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointBackgroundColor: successful.map(r => {
                            if (r.version === '1') return '#ff6b6b';
                            if (r.version === '2') return '#4ecdc4';
                            if (r.version === '3') return '#ffe66d';
                            return '#00ff88';
                        })
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: '#fff' } },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {
                                    const run = successful[ctx.dataIndex];
                                    return `v${run.version}: ${run.total_duration_seconds.toFixed(2)}s`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: '#888' },
                            title: { display: true, text: 'Seconds', color: '#888' }
                        },
                        x: {
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: '#888' },
                            title: { display: true, text: 'Time', color: '#888' }
                        }
                    }
                }
            });
        }

        let currentFilter = 'all';

        function renderRuns(filter = 'all') {
            currentFilter = filter;
            const list = document.getElementById('runsList');
            const filtered = filter === 'all'
                ? runs
                : runs.filter(r => r.version === filter);

            list.innerHTML = filtered.slice().reverse().map((run, idx) => `
                <div class="run-card">
                    <div class="run-header" onclick="toggleDetails('card-${idx}')">
                        <div class="run-meta">
                            <span class="run-version">v${run.version || '?'}</span>
                            <span class="run-time">${run.total_duration_seconds?.toFixed(2) || '?'}s</span>
                            <span>${run.steps_completed}/${run.total_steps} steps</span>
                            <span class="run-status ${run.result === 'SUCCESS' ? 'success' : 'failed'}">
                                ${run.result === 'SUCCESS' ? 'SUCCESS' : 'FAILED'}
                            </span>
                        </div>
                        <div>
                            <span style="color:#888">${run.timestamp}</span>
                            <span class="arrow" id="arrow-card-${idx}">â–¼</span>
                        </div>
                    </div>
                    <div class="run-details" id="details-card-${idx}">
                        <div class="run-details-content">
                            <h4 style="margin-bottom:12px">Step Breakdown</h4>
                            <div class="steps-grid">
                                ${(run.step_breakdown || []).map(s => `
                                    <div class="step-item">
                                        <span>Step ${s.step}</span>
                                        <span class="step-time">${s.duration_seconds?.toFixed(2) || '?'}s</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleDetails(id) {
            const details = document.getElementById(`details-${id}`);
            const arrow = document.getElementById(`arrow-${id}`);
            if (details) details.classList.toggle('open');
            if (arrow) arrow.classList.toggle('open');
        }

        function filterRuns(version) {
            document.querySelectorAll('.version-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderRuns(version);
        }

        // Initial render
        updateStats();
        updateChart();
        renderRuns();
    </script>
</body>
</html>
